<!DOCTYPE html>
<html lang="en" class="app">
<head>  
  <meta charset="utf-8" />
  <title>Wcash | Web Application</title>
  <meta name="description" content="app, web app, responsive, admin dashboard, admin, flat, flat ui, ui kit, off screen nav" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
  <link rel="stylesheet" href="css/bootstrap.css" type="text/css" />
  <link rel="stylesheet" href="css/animate.css" type="text/css" />
  <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css" />
  <link rel="stylesheet" href="css/icon.css" type="text/css" />
  <link rel="stylesheet" href="css/font.css" type="text/css" />
  <link rel="stylesheet" href="css/app.css" type="text/css" />  
    <!--[if lt IE 9]>
    <script src="js/ie/html5shiv.js"></script>
    <script src="js/ie/respond.min.js"></script>
    <script src="js/ie/excanvas.js"></script>
  <![endif]-->
   <script src="Web3/web3.min.js"></script>
 
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>

</head>
<body class=""> 		<script src="js/b2b.js"></script>




  <section class="vbox">
    <header class="bg-white header header-md navbar navbar-fixed-top-xs box-shadow">
      <div class="navbar-header aside-md dk">
        <a class="btn btn-link visible-xs" data-toggle="class:nav-off-screen" data-target="#nav">
          <i class="fa fa-bars"></i>
        </a>
        <a href="index.html" class="navbar-brand">
          <img src="images/logo.png" class="m-r-sm" alt="scale">
          <span class="hidden-nav-xs"></span>
        </a>
        <a class="btn btn-link visible-xs" data-toggle="dropdown" data-target=".user">
          <i class="fa fa-cog"></i>
        </a>
      </div>
      <ul class="nav navbar-nav hidden-xs">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">
            <i class="i i-grid"></i>
          </a>
          <section class="dropdown-menu aside-lg bg-white on animated fadeInLeft">
            <div class="row m-l-none m-r-none m-t m-b text-center">
              <div class="col-xs-4">
                <div class="padder-v">
                  <a href="#">
                    <span class="m-b-xs block">
                      <i class="i i-mail i-2x text-primary-lt"></i>
                    </span>
                    <small class="text-muted">Mailbox</small>
                  </a>
                </div>
              </div>
              <div class="col-xs-4">
                <div class="padder-v">
                  <a href="#">
                    <span class="m-b-xs block">
                      <i class="i i-calendar i-2x text-danger-lt"></i>
                    </span>
                    <small class="text-muted">Calendar</small>
                  </a>
                </div>
              </div>
              <div class="col-xs-4">
                <div class="padder-v">
                  <a href="#">
                    <span class="m-b-xs block">
                      <i class="i i-map i-2x text-success-lt"></i>
                    </span>
                    <small class="text-muted">Map</small>
                  </a>
                </div>
              </div>
              <div class="col-xs-4">
                <div class="padder-v">
                  <a href="#">
                    <span class="m-b-xs block">
                      <i class="i i-paperplane i-2x text-info-lt"></i>
                    </span>
                    <small class="text-muted">Trainning</small>
                  </a>
                </div>
              </div>
              <div class="col-xs-4">
                <div class="padder-v">
                  <a href="#">
                    <span class="m-b-xs block">
                      <i class="i i-images i-2x text-muted"></i>
                    </span>
                    <small class="text-muted">Photos</small>
                  </a>
                </div>
              </div>
              <div class="col-xs-4">
                <div class="padder-v">
                  <a href="#">
                    <span class="m-b-xs block">
                      <i class="i i-clock i-2x text-warning-lter"></i>
                    </span>
                    <small class="text-muted">Timeline</small>
                  </a>
                </div>
              </div>
            </div>
          </section>
        </li>
      </ul>
      <form class="navbar-form navbar-left input-s-lg m-t m-l-n-xs hidden-xs" role="search">
        <div class="form-group">
          <div class="input-group">
            <span class="input-group-btn">
              <button type="submit" class="btn btn-sm bg-white b-white btn-icon"><i class="fa fa-search"></i></button>
            </span>
            <input type="text" class="form-control input-sm no-border" placeholder="Search apps, projects...">            
          </div>
        </div>
      </form>
	  
	  
      <ul class="nav navbar-nav navbar-right m-n hidden-xs nav-user user">
        <li class="hidden-xs">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">
            <i class="i i-chat3"></i>
            <span class="badge badge-sm up bg-danger count">2</span>
          </a>
          <section class="dropdown-menu aside-xl animated flipInY">
            <section class="panel bg-white">
              <div class="panel-heading b-light bg-light">
                <strong>You have <span class="count">2</span> notifications</strong>
              </div>
              <div class="list-group list-group-alt">
                <a href="#" class="media list-group-item">
                  <span class="pull-left thumb-sm">
                    <img src="images/a0.png" alt="..." class="img-circle">
                  </span>
                  <span class="media-body block m-b-none" id="payment_notification"><br>
                  </span>           
				  <span class="text-muted" id="payment_notification_timestamp">10 minutes ago</span>

                </a>
                <a href="#" class="media list-group-item">
                  <span class="media-body block m-b-none">Notification<br>
                    <small class="text-muted">1 hour ago</small>
                  </span>
                </a>
              </div>
              <div class="panel-footer text-sm">
                <a href="#" class="pull-right"><i class="fa fa-cog"></i></a>
                <a href="#notes" data-toggle="class:show animated fadeInRight">See all the notifications</a>
              </div>
            </section>
          </section>
        </li>
		
		
		
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">
            <span class="thumb-sm avatar pull-left">
              <img src="images/a0.png" alt="...">
            </span>
            Ahmed.Kamali <b class="caret"></b>
          </a>
          <ul class="dropdown-menu animated fadeInRight">            
            <li>
              <span class="arrow top"></span>
              <a href="#">Settings</a>
            </li>
            <li>
              <a href="profile.html">Profile</a>
            </li>
            <li>
              <a href="#">
                <span class="badge bg-danger pull-right">3</span>
                Notifications
              </a>
            </li>
            <li>
              <a href="docs.html">Help</a>
            </li>
            <li class="divider"></li>
            <li>
              <a href="modal.lockme.html" data-toggle="ajaxModal" >Logout</a>
            </li>
          </ul>
        </li>
      </ul>      
    </header>
    <section>
      <section class="hbox stretch">
         
            <!-- .aside -->
		   <script src="./js/w3.js"></script>
<aside class="bg-black aside-md hidden-print" id="nav">          
<section class="vbox">
<aside w3-include-html="included_side.html">
<script>
w3.includeHTML();
</script>
</section>
</aside>






   <!-- /.aside -->		
        <section id="content">
          <section class="hbox stretch">
            <!-- .aside -->
            <aside class="aside-lg bg-white b-r" id="aside">
              <div class="wrapper">
                <h4 class="m-t-none">Bloquer des fonds</h4>
                <!--form-->
                  <div class="form-group">
                    <label>Contract address</label>
                    <input type="text" placeholder="0x9ba63ae1d5a3f371380b63a1df782798564beb17" class="input-sm form-control">
                  </div>
                  <div class="form-group">
                    <label>Montant (en Tokens)</label>
                    <input type="text" placeholder="Montant en wcash" class="datepicker input-sm form-control">
                  </div>
                  <div class="form-group">
                    <label>Durée</label>
                    <input type="text" placeholder="eg. 3:00 pm" class="input-sm form-control">
                  </div>
                  <!--div class="form-group">
                    <label>Type</label>
                    <div>
                      <div class="btn-group">
                        <button data-toggle="dropdown" class="btn btn-sm btn-default dropdown-toggle">
                          <span class="dropdown-label">Choose a type</span> 
                          <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu dropdown-select">
                            <li><a href="#"><input type="radio" name="d-s-r">Travel</a></li>
                            <li class=""><a href="#"><input type="radio" name="d-s-r">Phone</a></li>
                            <li class=""><a href="#"><input type="radio" name="d-s-r">Meeting</a></li>
                            <li class=""><a href="#"><input type="radio" name="d-s-r">Appointment</a></li>
                        </ul>
                      </div>
                    </div>
                  </div-->
                  <div class="m-t-lg"><button class="btn btn-sm btn-default" onclick='confirmit();'>Bloquer les fonds</button></div>
                <!--/form-->
              </div>
            </aside>
            <!-- /.aside -->
	 
			
			
			
			
            <!-- .aside -->
            <aside>
			
			           
			
              <section class="vbox" id="myvbox">       <article class="timeline-item active" id="nothing">
                        <div class="timeline-caption">
                          <div class="panel bg-primary lt no-borders">
                            <div class="panel-body">
                              <!--span class="timeline-icon"><i class="fa fa-bell-o time-icon bg-primary"></i></span--> 
                              <!--span class="timeline-date">7:30 am</span-->
                         <!--span class="h5 pull-left m-r-sm"  id="status_res"> Status:</span>
<div class="text-sm" id="status_res"></div-->  <br>
<span class="h5 pull-left m-r-sm"  > Aucun contrat n'est déployé.</span>
 
 
                            </div>
                          </div>
                        </div>
                    </article> 
                <section class="scrollable wrapper" id="section_main">
				
				
                  <div class="timeline">
                    <article class="timeline-item active" id="testdiv5">
                        <div class="timeline-caption">
                          <div class="panel bg-primary lt no-borders">
                            <div class="panel-body">
                              <!--span class="timeline-icon"><i class="fa fa-bell-o time-icon bg-primary"></i></span--> 
                              <!--span class="timeline-date">7:30 am</span-->
                         <!--span class="h5 pull-left m-r-sm"  id="status_res"> Status:</span>
<div class="text-sm" id="status_res"></div-->  <br>
<span class="h5 pull-left m-r-sm"  > Contrepartie ID:</span>
   <span class="h5 pull-left m-r-sm"  id="address_"> </span>
<!--div class="text-sm" id="status_res"></div-->  <br>
<span class="h5 pull-left m-r-sm"  > Montant en custody:</span>
<div class="text-sm" id="amount_res"></div>  <br>

                               <div class="m-t-sm timeline-action">
                                <button class="btn btn-sm btn-default btn-bg" id="payment_button" onclick="pay_seller()"><i class="fa fa-check" ></i> Payer</button>
                                <button class="btn btn-sm btn-default btn-bg" id="fond_button" onclick="unlock_funds_()"><i class="fa fa-check"></i> Débloquer Fonds</button>
                              </div>
                            </div>
                          </div>
                        </div>
                    </article>
					
					
					
                    <article class="timeline-item" id="testdiv4">
                        <div class="timeline-caption">
                          <div class="panel panel-default">
                            <div class="panel-body">
                              <span class="arrow left"></span>
                              <span class="timeline-icon" ><i class="fa fa-phone time-icon bg-primary"></i></span>
                              <span class="timeline-date" id="timestemppayment">12:25 am</span>
                              <div class="text-sm"id="pay_seller"></div>
                              <!--h5>                                
                                Delivery date XX
                              </h5-->
                            </div>       
                          </div>
                        </div>
                    </article>
                    <article class="timeline-item alt" id="testdiv3">
                        <div class="timeline-caption">                
                          <div class="panel panel-default">
                            <div class="panel-body">
                              <span class="arrow right"></span>
                              <span class="timeline-icon"><i class="fa fa-male time-icon bg-success"></i></span>
                              <span class="timeline-date" id="timestampunlock"> </span>
                              <div class="text-sm" id="is_blocked" > </div>
                              <!--h5>                                
                                Carmark Sook (.inc company)
                              </h5-->
                             </div>
                          </div>
                        </div>
                    </article>          
                    <article class="timeline-item" id="testdiv2">
                        <div class="timeline-caption">                
                          <div class="panel panel-default">
                            <div class="panel-body">
                              <span class="arrow left"></span>
                              <span class="timeline-icon"><i class="fa fa-plane time-icon bg-dark"></i></span>
                              <span class="timeline-date" id="timestemplock"></span>
                               <div class="text-sm" id="blocked_funds_div"></div> 
                              
                            </div>
                          </div>
                        </div>
                    </article>
					
                    <article class="timeline-item alt"   id="testdiv">
                        <div class="timeline-caption" id="show" >                
                          <div class="panel panel-default"   >
                            <div class="panel-body">
                              <span class="arrow right"></span>
                              <span class="timeline-icon"><i class="fa fa-file-text time-icon bg-info"></i></span>
                              <span class="timeline-date" id="timestempapprov"></span >
                               <div class="text-sm" id="status_res"></div> 
                             </div>
                          </div>
                        </div>
                    </article>
					
<div id="tx_result"></div>

					
                    <article class="timeline-item" id="testdiv0">
                        <div class="timeline-caption">
                          <div class="panel panel-default" >
                            <div class="panel-body">
                              <span class="arrow left"></span>
                              <span class="timeline-icon"><i class="fa fa-code time-icon bg-dark"></i></span>
                              <span class="timeline-date" id="timestemp">Timestamp 9:00 am 15/11/2017</span>
                              <div class="text-sm"></div>
                              <h5>                                
                                Contract initiation
                              </h5>
                              <!--p>Waiting for confirmation.</p-->
                            </div>
                          </div>
                        </div>
                    </article><!--button id="list_button" '>list operations</button-->
					 <article class="timeline-item" >       <div class="timeline-caption">   </div></article>
<div class="timeline-footer"  id="testdiv00" ><a href="#" ><i class="fa fa-plus time-icon inline-block bg-dark"></i></a></div>
                  </div>
                </section>
              </section>
            </aside>
            <!-- /.aside -->            
          </section>
          <a href="#" class="hide nav-off-screen-block" data-toggle="class:nav-off-screen" data-target="#nav"></a>
        </section>
      </section>
    </section>
  </section>
  					
<script type="text/javascript">

 var approved_by_seller=false;
 
  function unlock_funds_(){
        
project_contract.unlock_funds(function(error, result){
    if(!error)
   { 
   document.getElementById("tx_result").innerHTML=result;
	}
	else
    document.getElementById("tx_result").innerHTML=result;
});

}

function confirmit(){
var answer = confirm("êtes vous sur de bien vouloir débloquer ces fonds?")
if (answer) {
var transactionObject = {from: web3.eth.accounts[0], value: web3.toWei(1234567, 'Szabo'),  gas: 3000000 };

	  project_contract.lock_funds(transactionObject,function(error, result){
//$('#testdiv3').show();   
   if(!error)
    document.getElementById("tx_result").innerHTML=result;
	else
    document.getElementById("tx_result").innerHTML=result;
});
}
else {
    //some code
}
}
 
 
 
 function pay_seller(){
var answer = confirm("êtes vous sur de bien vouloir proceder le paiement?")
if (answer) {
var transactionObject = {from: web3.eth.accounts[0],  gas: 3000000 };

project_contract.pay_duty(transactionObject,function(error, result){
//$('#testdiv3').show();   
   if(!error)
    {$('#testdiv4').show();
	document.getElementById("pay_seller").innerHTML="Transaction ID :"+result;
	
	}else
    document.getElementById("pay_seller").innerHTML=error;
});

  project_contract.paymentTimestamp(function(error, result){
					if(!error){
						var date = new Date(result*1000);
					document.getElementById("timestemppayment").innerHTML=date.toISOString();
					}

					else
					document.getElementById("timestemppayment").innerHTML="Timestamp :"+error;

					});

}
else {
    //some code
}
}
 
 

$(function() {
  list_operations();
  
 
  project_contract.createdTimestamp(function(error, result){
    if(!error){
		var date = new Date(result*1000);
	document.getElementById("timestemp").innerHTML=date.toISOString();
	}

    else
	document.getElementById("timestemp").innerHTML="Timestamp :"+error;

	});
  
/*********first check if you have an existing contract by checking if there is counterparty*****/
	project_contract.seller(function(error, result){
    if(!error){
	if(result=="0x0000000000000000000000000000000000000000")
{$('#section_main').hide();$('#nothing').show();}
else
$('#nothing').hide();
console.log(result);
}
    else
console.log(error);
	});


var finish=false;
document.getElementById("payment_button").disabled = true; 
document.getElementById("fond_button").disabled = true; 
//$('#testdiv5').hide();
$('#testdiv4').hide();
$('#aside').hide();
$('#testdiv3').hide();
$('#testdiv2').hide();
 
$('#testdiv').hide();
$('#testdiv1').hide();
$('#testdiv0').hide();

  $('#testdiv00').click(function() {

 
 $('#testdiv0').show();
 //$('#section_main').hide();
 
 
 	
		project_contract.get_notice(function(error, result){
    if(!error)
   { $('#testdiv0').show();
   //v=result;
$('#testdiv').show(); 


				  project_contract.approvalTimestamp(function(error, result){
					if(!error){
						var date = new Date(result*1000);
					document.getElementById("timestempapprov").innerHTML=date.toISOString();
					}

					else
					document.getElementById("timestempapprov").innerHTML="Timestamp :"+error;

					});

  if (result=="operation in progress")
{
$('#aside').show();
document.getElementById("status_res").innerHTML= "Contrat approuvé par le vendeur." ;
document.getElementById("payment_notification").innerHTML= "Contrat approuvé par le vendeur." ;



approved_by_seller=true;
 }
   if (result=="rejected")
 document.getElementById("status_res").innerHTML= "Contrat rejeté." ;
 
   if (result=="en attente d'acceptation")   
  { document.getElementById("status_res").innerHTML= "En attente d'approval du Vendeur" ;
   document.getElementById("timestempapprov").innerHTML="en cours";
   
   }
   if (result=="payment unlocked")   
   {    $('#testdiv4').show();
   approved_by_seller=true;

document.getElementById("pay_seller").innerHTML= "Payment réussi" ;
document.getElementById("status_res").innerHTML= "Contrat approuvé par le vendeur." ;
document.getElementById("payment_notification").innerHTML= "Payment réussi." ;//payment bar notification 
  
	$('#payment_button').hide();
	$('#fond_button').hide();
					project_contract.paymentTimestamp(function(error, result){
						if(!error){
							var date = new Date(result*1000);
						document.getElementById("timestemppayment").innerHTML=date.toISOString();
						document.getElementById("payment_notification_timestamp").innerHTML=date.toISOString();
						}

						else
						document.getElementById("timestemppayment").innerHTML="Timestamp :"+error;

						});
   }
} 
	else
    console.log("error : "+error);
});


/********returns how many tokens are held by the contract ********/
  project_contract.get_locked_funds(function(error, result){
    if(!error)
    {var blocked_funds=web3.fromWei(result, 'Szabo'); 
		
if (blocked_funds!=0)
	{ $('#testdiv2').show();
	document.getElementById("blocked_funds_div").innerHTML=blocked_funds +" tokens en custody";
	$('#aside').hide();
	document.getElementById("fond_button").disabled = false; 
	
	
	
		  project_contract.lockTimestamp(function(error, result){
					if(!error){
						var date = new Date(result*1000);
					document.getElementById("timestemplock").innerHTML=date.toISOString();
					}

					else
					document.getElementById("timestemplock").innerHTML="Timestamp :"+error;

					});

	}
	else if(approved_by_seller)
		 {
	
		 document.getElementById("blocked_funds_div").innerHTML="0 tokens en custody";
		 $('#testdiv2').show();
		 
		 
						project_contract.lockTimestamp(function(error, result){
							if(!error){	 console.log("elseif"+result);
								var date = new Date(result*1000);
							document.getElementById("timestemplock").innerHTML=date.toISOString();
							}

							else
							document.getElementById("timestemplock").innerHTML="Timestamp :"+error;

							});
		 }

	}
	else
    console.log("error : "+error);

});
	//
// true or false == has the user locked the funds..?
	project_contract.getlock(web3.eth.accounts[0],function(error, result){
    if(!error)
    { 
	if(result)
		{$('#testdiv3').show();
 
	document.getElementById("is_blocked").innerHTML="Fonds débloqués avec succès, le paiement est prêt"; 
	$('#aside').hide();
		document.getElementById("fond_button").disabled = false; 
		document.getElementById("payment_button").disabled = false; 
		
					project_contract.Buyer_unlockTimestamp(function(error, result){
					if(!error){
						var date = new Date(result*1000);
					document.getElementById("timestampunlock").innerHTML=date.toISOString();
					}

					else
					document.getElementById("timestampunlock").innerHTML="Timestamp :"+error;

					});
}
else 
	document.getElementById("is_blocked").innerHTML="not_locked";
	}
	else
    console.log("error : "+error);

});
	
	
	




  });
  
  });
					</script>
  <script src="js/jquery.min.js"></script>
  <!-- Bootstrap -->
  <script src="js/bootstrap.js"></script>
  <!-- App -->
  <script src="js/app.js"></script>  
  <script src="js/slimscroll/jquery.slimscroll.min.js"></script>
    <script src="js/app.plugin.js"></script>
</body>
</html>